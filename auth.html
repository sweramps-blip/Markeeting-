<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Power Star | Secure Auth</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --p: #d4ff00; --bg: #0a0e1a; --card-bg: #151b2d; --text: #94a3b8; }
        body { font-family: 'Outfit', sans-serif; background: var(--bg); color: #fff; margin: 0; padding: 20px; display: flex; justify-content: center; align-items: center; min-height: 100vh; overflow-x: hidden; }
        
        .card { background: var(--card-bg); padding: 30px; border-radius: 24px; width: 100%; max-width: 400px; border: 1px solid #2a344d; box-shadow: 0 20px 40px rgba(0,0,0,0.4); text-align: center; display: none; }
        
        .reg-header h1 { font-size: 28px; color: var(--p); margin: 0 0 10px 0; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; }
        .reg-header p { color: var(--text); font-size: 14px; margin-bottom: 25px; }
        
        .info-box { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.1); }
        .info-box p { margin: 5px 0; font-size: 13px; color: #eee; }
        .info-box b { color: var(--p); font-size: 15px; }
        
        input { width: 100%; padding: 15px; margin-bottom: 15px; border-radius: 12px; border: 1px solid #2a344d; background: #0a0e1a; color: #fff; box-sizing: border-box; font-size: 15px; transition: 0.3s; }
        input:focus { border-color: var(--p); outline: none; box-shadow: 0 0 10px rgba(212, 255, 0, 0.1); }
        
        .file-box { border: 2px dashed #3d4b6e; padding: 15px; border-radius: 12px; margin-bottom: 20px; display: flex; align-items: center; justify-content: space-between; background: rgba(0,0,0,0.2); }
        #fileName { font-size: 12px; color: var(--text); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 160px; }
        
        .upload-btn { background: #2a344d; color: #fff; padding: 8px 15px; border-radius: 8px; font-size: 12px; font-weight: 600; cursor: pointer; border: none; }
        
        .main-btn { width: 100%; padding: 18px; border-radius: 15px; border: none; background: var(--p); color: #000; font-weight: 800; cursor: pointer; font-size: 16px; box-shadow: 0 8px 25px rgba(212, 255, 0, 0.3); transition: 0.3s; }
        .main-btn:active { transform: scale(0.97); }

        /* Pending Screen Animations */
        .status-icon { font-size: 60px; color: var(--p); margin-bottom: 20px; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { opacity: 1; transform: scale(1); } 50% { opacity: 0.6; transform: scale(1.05); } 100% { opacity: 1; transform: scale(1); } }
        
        .loading-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg); display: flex; justify-content: center; align-items: center; z-index: 9999; }
        .loader { width: 40px; height: 40px; border: 4px solid #151b2d; border-top: 4px solid var(--p); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

<div id="loader" class="loading-screen">
    <div class="loader"></div>
</div>

<div id="regS" class="card">
    <div class="reg-header">
        <h1>Power Star</h1>
        <p>Official Membership Portal</p>
    </div>
    
    <div class="info-box">
        <p>Registration Fee: <b>Rs. 200</b> (Life Time)</p>
        <p>EasyPaisa: <b>03412049729</b></p>
        <p>Name: <b>Muhammad Hussain</b></p>
    </div>

    <input id="n" type="text" placeholder="Full Name">
    <input id="i" type="text" placeholder="Power Star ID (Main Page ID)">
    <input id="trx" type="number" placeholder="TRX ID (11 Digits)">

    <div class="file-box">
        <span id="fileName">Payment Screenshot</span>
        <button class="upload-btn" onclick="document.getElementById('fileInput').click()">CHOOSE FILE</button>
    </div>
    <input type="file" id="fileInput" accept="image/*" style="display: none;" onchange="updateName(this)">

    <button class="main-btn" onclick="register()">ACTIVATE NOW</button>
</div>

<div id="penS" class="card">
    <i class="fas fa-history status-icon"></i>
    <h2 style="color: var(--p);">Review in Progress</h2>
    <p style="color: var(--text); line-height: 1.6; font-size: 14px;">Your payment proof has been submitted. Admin will verify your TRX ID. This usually takes 1-12 hours.</p>
    <div style="margin-top: 25px; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 10px; font-size: 13px;">
        User ID: <span id="displayID" style="color: var(--p); font-weight: bold;">---</span>
    </div>
</div>

<script>
    // اہم لنکس
    const GAS_URL = "آپ_کا_GOOGLE_SCRIPT_URL_یہاں_لگائیں"; 
    const IMGBB_KEY = "14d35273fb4122ebb999baa08057f3f0";

    window.onload = () => {
        const savedID = localStorage.getItem("psID");
        if (savedID) {
            checkStatus(savedID);
        } else {
            hideLoader();
            document.getElementById("regS").style.display = "block";
        }
    };

    function updateName(input) {
        if (input.files.length > 0) {
            document.getElementById('fileName').innerText = input.files[0].name;
        }
    }

    function hideLoader() {
        document.getElementById("loader").style.display = "none";
    }

    async function checkStatus(id) {
        document.getElementById("displayID").innerText = id;
        try {
            let r = await fetch(GAS_URL + "?checkID=" + encodeURIComponent(id));
            let res = await r.json();

            if (res.status === "Approved") {
                window.location.href = "dashboard.html"; 
            } else if (res.status === "Pending") {
                hideLoader();
                document.getElementById("regS").style.display = "none";
                document.getElementById("penS").style.display = "block";
            } else {
                // اگر آئی ڈی نہیں ملی
                hideLoader();
                document.getElementById("regS").style.display = "block";
            }
        } catch (e) {
            // ایرر کی صورت میں پینڈنگ دکھانا سیف ہے
            hideLoader();
            document.getElementById("penS").style.display = "block";
        }
    }

    async function register() {
        const name = document.getElementById("n").value.trim();
        const userid = document.getElementById("i").value.trim();
        const trx = document.getElementById("trx").value.trim();
        const file = document.getElementById("fileInput").files[0];

        if (!name || !userid || !trx || !file) {
            return Swal.fire("Required", "All fields are mandatory", "warning");
        }

        if (trx.length < 11) {
            return Swal.fire("Invalid TRX", "TRX ID must be 11 digits", "error");
        }

        Swal.fire({ title: 'Submitting...', text: 'Uploading proof, please wait', allowOutsideClick: false, didOpen: () => Swal.showLoading() });

        try {
            // 1. Uploading to ImgBB
            let fd = new FormData();
            fd.append("image", file);
            let imgRes = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_KEY}`, { method: "POST", body: fd });
            let imgData = await imgRes.json();

            if (!imgData.success) throw new Error("Image Upload Error");

            // 2. Saving to Google Sheets
            let response = await fetch(GAS_URL, {
                method: "POST",
                body: JSON.stringify({
                    type: "reg",
                    id: userid,
                    name: name,
                    trx: trx,
                    proof: imgData.data.url
                })
            });

            localStorage.setItem("psID", userid);
            Swal.fire("Success", "Account submitted for approval!", "success").then(() => {
                location.reload();
            });

        } catch (error) {
            Swal.fire("Error", "Server connection failed. Try again.", "error");
        }
    }
</script>

</body>
</html>
