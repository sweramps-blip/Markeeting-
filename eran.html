<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Power Star | Earn</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        :root { --blue: #007bff; --bg: #f4f7f6; --white: #ffffff; --text: #333; }
        body { font-family: 'Outfit', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 0; display: flex; flex-direction: column; align-items: center; }
        
        /* Blue Top Bar - As per your screenshot */
        .header-bar { width: 100%; max-width: 400px; background: var(--blue); padding: 15px; display: flex; justify-content: space-between; align-items: center; color: white; font-weight: 700; border-radius: 0 0 15px 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 100; }

        .container { width: 100%; max-width: 400px; padding: 15px; box-sizing: border-box; }
        
        /* White Card Design */
        .white-card { background: var(--white); padding: 25px; border-radius: 20px; box-shadow: 0 5px 20px rgba(0,0,0,0.05); text-align: center; margin-top: 10px; border: 1px solid #e0e0e0; }

        .input-field { width: 100%; padding: 15px; margin: 10px 0; border-radius: 10px; border: 1px solid #ddd; background: #fff; font-size: 14px; box-sizing: border-box; }

        .q-text { font-size: 20px; direction: rtl; margin: 25px 0; font-weight: 700; color: #000; line-height: 1.5; }
        .opt-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px; }
        .opt-btn { background: #f8f9fa; border: 1px solid #ddd; padding: 16px; border-radius: 12px; color: #333; cursor: pointer; font-weight: 600; font-size: 14px; }
        
        .correct { background: #28a745 !important; color: white !important; }
        .wrong { background: #dc3545 !important; color: white !important; }

        .submit-btn { width: 100%; background: var(--blue); color: white; padding: 18px; border: none; border-radius: 15px; font-size: 18px; font-weight: 800; cursor: pointer; box-shadow: 0 5px 15px rgba(0,123,255,0.3); }

        .ad-area { width: 100%; background: #fff; border-radius: 10px; margin: 20px 0; border: 1px dashed #bbb; display: flex; justify-content: center; align-items: center; min-height: 250px; }
    </style>
</head>
<body>

<div class="header-bar" id="topBar" style="display:none;">
    <div>Rs. <span id="bal">0.00</span></div>
    <div>Limit: <span id="taskDone">0</span>/200</div>
</div>

<div class="container">
    <div id="regS" class="white-card">
        <h2 style="color:var(--blue); margin-bottom:10px;">Power Star</h2>
        <input id="uName" class="input-field" placeholder="Full Name">
        <input id="uId" class="input-field" placeholder="User ID">
        <input id="uTrx" class="input-field" placeholder="11-Digit Trx ID">
        <div style="text-align:left; font-size:12px; color:#888; margin-top:10px;">Upload Payment Screenshot:</div>
        <input type="file" id="uFile" class="input-field" style="border:none;">
        <button class="submit-btn" onclick="register()">ACTIVATE NOW</button>
    </div>

    <div id="penS" class="white-card" style="display:none;">
        <div style="font-size:50px; color:var(--blue);">⏳</div>
        <h3>Approval Pending</h3>
        <p style="color:#666;">Admin is verifying your payment. Check back in 1-6 hours.</p>
    </div>

    <div id="quizS" style="display:none;">
        <div class="white-card">
            <div id="qT" class="q-text">سوال لوڈ ہو رہا ہے...</div>
            <div id="qG" class="opt-grid"></div>
        </div>

        <div class="ad-area">
            <script type="text/javascript">
                atOptions = { 'key' : '577f75aa7d65a7ccebfa35e124c256c4', 'format' : 'iframe', 'height' : 250, 'width' : 300, 'params' : {} };
            </script>
            <script type="text/javascript" src="//www.highperformanceformat.com/577f75aa7d65a7ccebfa35e124c256c4/invoke.js"></script>
        </div>

        <button class="submit-btn" id="mB" onclick="handleBtn()">جواب جمع کریں</button>
    </div>
</div>

<script>
    const API = "https://script.google.com/macros/s/AKfycbyD4XH_WPLQBnRyLxIGTLxhXJ0OY6cnZLQvNgrmIqkAC9RTMdtxgdEXG4h17uKz-sZhZQ/exec";
    const IMBB = "14d35273fb4122ebb999baa08057f3f0";
    let uId = localStorage.getItem("psID"), questions = [], cur, sel, score = 0, done = 0;

    async function checkStatus() {
        if (!uId) return show("regS");
        try {
            let r = await fetch(API + "?checkID=" + uId);
            let res = await r.json();
            if (res.status === "Approved") setup();
            else if (res.status === "Pending") show("penS");
            else show("regS");
        } catch(e) { show("regS"); }
    }

    function show(id) {
        document.getElementById("regS").style.display = "none";
        document.getElementById("penS").style.display = "none";
        document.getElementById("quizS").style.display = "none";
        document.getElementById(id).style.display = "block";
        if(id === "quizS") document.getElementById("topBar").style.display = "flex";
    }

    async function register() {
        let n = document.getElementById("uName").value, i = document.getElementById("uId").value,
            t = document.getElementById("uTrx").value, f = document.getElementById("uFile").files[0];
        if(!n || !i || !t || !f) return alert("All fields are required");

        Swal.fire({title: 'Submitting...', didOpen: () => Swal.showLoading()});
        let fd = new FormData(); fd.append("image", f);
        let imgR = await fetch(`https://api.imgbb.com/1/upload?key=${IMBB}`, {method:"POST", body:fd});
        let imgD = await imgR.json();

        await fetch(API, { method: "POST", body: JSON.stringify({ type: "reg", id: i, name: n, trx: t, proof: imgD.data.url })});
        localStorage.setItem("psID", i);
        location.reload();
    }

    async function setup() {
        show("quizS");
        let r = await fetch(API);
        questions = await r.json();
        nextQ();
    }

    function nextQ() {
        sel = null; document.getElementById("mB").innerText = "جواب جمع کریں";
        cur = questions[Math.floor(Math.random() * questions.length)];
        document.getElementById("qT").innerText = cur.q;
        let h = ""; cur.a.forEach((o, idx) => { h += `<button class="opt-btn" onclick="s(${idx}, this)">${o}</button>`; });
        document.getElementById("qG").innerHTML = h;
        document.getElementById("taskDone").innerText = done;
    }

    function s(idx, b) { 
        if(document.getElementById("mB").innerText === "اگلا سوال") return;
        sel = {idx, b}; 
        document.querySelectorAll(".opt-btn").forEach(x => { x.style.border = "1px solid #ddd"; x.style.background = "#f8f9fa"; });
        b.style.border = "2px solid var(--blue)"; b.style.background = "#e7f1ff";
    }

    function handleBtn() {
        let b = document.getElementById("mB");
        if (b.innerText === "اگلا سوال") { done++; nextQ(); return; }
        if (!sel) return;
        if (sel.idx == cur.c) { sel.b.classList.add("correct"); score += 0.4; }
        else { sel.b.classList.add("wrong"); document.querySelectorAll(".opt-btn")[cur.c].classList.add("correct"); }
        document.getElementById("bal").innerText = score.toFixed(2);
        b.innerText = "اگلا سوال";
    }

    checkStatus();
</script>
</body>
</html>
